<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- add description and keywords for SEO -->
  <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Setting import path for go generate | Suhas Bharadwaj</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="Setting import path for go generate" />
<meta name="author" content="Suhas Bharadwaj" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Go generate can be used to automatically generate imports. But it is easy to mess it up. Here is what you could do to set it right." />
<meta property="og:description" content="Go generate can be used to automatically generate imports. But it is easy to mess it up. Here is what you could do to set it right." />
<link rel="canonical" href="http://localhost:4000/setting-import-path-for-go-generate" />
<meta property="og:url" content="http://localhost:4000/setting-import-path-for-go-generate" />
<meta property="og:site_name" content="Suhas Bharadwaj" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-10-23T00:00:00+05:30" />
<script type="application/ld+json">
{"description":"Go generate can be used to automatically generate imports. But it is easy to mess it up. Here is what you could do to set it right.","author":{"@type":"Person","name":"Suhas Bharadwaj"},"@type":"BlogPosting","url":"http://localhost:4000/setting-import-path-for-go-generate","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/nr-logo.jpg"},"name":"Suhas Bharadwaj"},"headline":"Setting import path for go generate","dateModified":"2016-10-23T00:00:00+05:30","datePublished":"2016-10-23T00:00:00+05:30","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/setting-import-path-for-go-generate"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="description" content="Go generate can be used to automatically generate imports. But it is easy to mess it up. Here is what you could do to set it right.">
  
 <meta name="keywords" content="golang, gocode, git, workflow, import, path, mess, fork, update, generate" />
  
  
  <meta name="author" content="Suhas Bharadwaj">
  <meta name="copyright" content="&copy; Suhas Bharadwaj 2018">
  

  <!-- External libraries -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/monokai_sublime.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/css/lightbox.css">

  <!-- Favicon and other icons (made with http://www.favicon-generator.org/) -->
  <!--<link rel="shortcut icon" href="/favicon.ico">
  <link rel="icon" sizes="16x16 32x32 64x64" href="/assets/icons/favicon.ico">
  <link rel="icon" type="image/png" sizes="196x196" href="/assets/icons/favicon-192.png">
  <link rel="icon" type="image/png" sizes="160x160" href="/assets/icons/favicon-160.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96.png">
  <link rel="icon" type="image/png" sizes="64x64" href="/assets/icons/favicon-64.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16.png">
  <link rel="apple-touch-icon" href="/assets/icons/favicon-57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/favicon-114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/favicon-72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/favicon-144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/favicon-60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/favicon-120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/favicon-76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/favicon-152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/favicon-180.png">
  <meta name="msapplication-TileColor" content="#FFFFFF">
  <meta name="msapplication-TileImage" content="/assets/icons/favicon-144.png">
  <meta name="msapplication-config" content="/assets/icons/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">-->
<link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/assets/icons/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="//assets/icons/avicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">

  
  <!-- Facebook OGP cards -->
  <meta property="og:description" content="Go generate is one of my favorite tools but it is easy to mess up the import paths if you are not careful. This problem generally occurs when the import path..." />
  <meta property="og:url" content="http://localhost:4000/setting-import-path-for-go-generate" />
  <meta property="og:site_name" content="Suhas Bharadwaj" />
  <meta property="og:title" content="Setting import path for go generate" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="http://localhost:4000/assets/nr-logo.jpg" />
  <meta property="og:image:type" content="image/jpg" />
  <meta property="og:image:width" content="612" />
  <meta property="og:image:height" content="605" />
    
  

  
  <!-- Twitter: card tags -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Setting import path for go generate">
  <meta name="twitter:description" content="Go generate is one of my favorite tools but it is easy to mess up the import paths if you are not careful. This problem generally occurs when the import path...">
  <meta name="twitter:image" content="http://localhost:4000/assets/nr-logo.jpg">
  <meta name="twitter:url" content="http://localhost:4000">
  

  

  <!-- Site styles -->
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://localhost:4000/setting-import-path-for-go-generate">
  <link rel="alternate" type="application/rss+xml" title="Suhas Bharadwaj" href="http://localhost:4000/feed.xml" />
</head>


  <body>

    <header class="navigation" role="banner">
  <div class="navigation-wrapper">
    <a href="/" class="logo">
      
      <img src="/assets/nr-logo.jpg" alt="Suhas Bharadwaj">
      
    </a>
    <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu">
      <i class="fa fa-bars"></i>
    </a>
    <nav role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">
        
          
          <li class="nav-link"><a href="/about/">About Me</a>
          
        
          
          <li class="nav-link"><a href="/archive/">Archive</a>
          
        
          
        
          
        
          
        
          
        
          
          <li class="nav-link"><a href="/talks/">Talks</a>
          
        
          
        
          
        
          
        
          
        
      </ul>
    </nav>
  </div>
</header>


    <div class="page-content">
        <div class="post">

<div class="post-header-container " >
  <div class="scrim ">
    <header class="post-header">
      <h1 class="title">Setting import path for go generate</h1>
      <p class="info">by <strong>Suhas Bharadwaj</strong></p>
    </header>
  </div>
</div>

<div class="wrapper">

 <span class="page-divider">
  <span class="one"></span>
  <span class="two"></span>
</span>
 

<section class="post-meta">
  <div class="post-date">October 23, 2016</div>
  <div class="post-categories">
  
  </div>
</section>

<article class="post-content">
  <p>Go generate is one of my favorite tools but it is easy to mess up the import paths if you are not careful. This problem generally occurs when the import paths end up referencing to <em>your</em> fork and not to the <em>original</em> repo. This is a very common issue if you are:</p>

<ol>
  <li>Using go generate</li>
  <li>Collaborating with others over github (essentially having your own fork of the project)</li>
</ol>

<h2 id="the-problem">The Problem</h2>

<p>I was working on <a href="https://github.com/taskcluster/taskcluster-cli">taskcluster-cli</a>. If you notice carefully, it has a file called <code class="highlighter-rouge">subtree-imports.go</code> which automatically imports <em>subtrees</em> on running <code class="highlighter-rouge">go generate</code>, which means it has import paths like:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>github.com/taskcluster/taskcluster-cli/apis
</code></pre></div></div>

<p>If I fork the project and automatically generate imports, it will import a path something like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>github.com/nikhita/taskcluster-cli/apis
</code></pre></div></div>

<p>As you can see, the import path generated are different. This is all horribly screwed up now! :(</p>

<h2 id="the-solution">The solution</h2>

<p>Let’s dive into the heart of the problem! The import paths get messed up because they depend on where the code is residing. When I clone my fork, the code is now residing at <code class="highlighter-rouge">$GOPATH/src/github.com/nikhita/taskcluster-cli </code> and not at <code class="highlighter-rouge">$GOPATH/src/github.com/taskcluster/taskcluster-cli</code> which leads to…import hell?</p>

<p>So the solution is to make sure that your code resides at <code class="highlighter-rouge">$GOPATH/src/github.com/taskcluster/taskcluster-cli</code>. Wait! Before you freak out and start yelling “I WANT TO MAKE CHANGES AND PUSH TO MY FORK, NOT THE ORIGINAL REPO!”, let’s add some more remotes! :D</p>

<h3 id="get-the-names-right">Get the names right</h3>

<p>If you do a <code class="highlighter-rouge">$ git remote -v</code> at the location where your original repo is, you’ll probably see something like this:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">origin    https://github.com/taskcluster/taskcluster-cli <span class="o">(</span>fetch<span class="o">)</span>
origin    https://github.com/taskcluster/taskcluster-cli <span class="o">(</span>push<span class="o">)</span></code></pre></figure>

<p>Before adding more remotes, let’s name everything how it should be. Let’s call this remote as <em>upstream</em>. Just do a <code class="highlighter-rouge">$ git remote rename origin upstream</code>.</p>

<p>For a sanity check, let’s <code class="highlighter-rouge">$ git remote -v</code> again:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">upstream    https://github.com/taskcluster/taskcluster-cli <span class="o">(</span>fetch<span class="o">)</span>
upstream    https://github.com/taskcluster/taskcluster-cli <span class="o">(</span>push<span class="o">)</span></code></pre></figure>

<p>Phew, we are out of messing up with names now! :)</p>

<h3 id="adding-your-fork">Adding your fork</h3>

<p>Now I’ll add my fork as a remote. Let’s call it <em>origin</em>.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git remote add origin https://github.com/nikhita/taskcluster-cli.git</code></pre></figure>

<p>We can see that doing this does us good:</p>

<ul>
  <li>Now our import paths point to <code class="highlighter-rouge">$GOPATH/src/github.com/taskcluster/taskcluster-cli</code> and not a directory with my fork.</li>
  <li>My import paths will no longer get messy.</li>
  <li>I can still safely make changes and push to my fork (origin).</li>
</ul>

<h3 id="fixing-branches">Fixing branches</h3>

<p>Read this only if you don’t have a fresh fork i.e. you have made some changes, pushed it to a remote repo (mostly your fork) and now realized that you have to sort out everything. If you a fresh fork, move onto the next section.</p>

<p>To fix this, you can create branches according to your fixes and make these branches track the branches in the remote fork.</p>

<ol>
  <li>Create a new branch according to your fix. Let’s call the branch <em>my-fix-local</em>.</li>
  <li>If you have previously worked on the fix and pushed it to your forked repo, make the local branch track your remote branch.</li>
  <li>Pull your work from the remote branch</li>
</ol>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># create a new branch</span>
<span class="nv">$ </span>git checkout <span class="nt">-b</span> my-fix-local
<span class="nv">$ </span>git checkout master
<span class="c"># list all branches</span>
<span class="nv">$ </span>git branch
<span class="c"># track the local branch with the remote branch</span>
<span class="nv">$ </span>git branch <span class="nt">--track</span> my-fix-local origin/my-fix-remote
<span class="c"># get your work back!</span>
<span class="nv">$ </span>git pull</code></pre></figure>

<h3 id="check-the-import-paths">Check the import paths</h3>

<p>Now that you have your repo in the right location, with the changes you had made, you can import all your paths again. This time, you’ll see that there would be no conflicts with original import paths and all’s good! :)</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>go generate</code></pre></figure>

<h3 id="lets-push-it">Let’s push it!</h3>

<ul>
  <li>Import paths in order? Check.</li>
  <li>Changes present? Check.</li>
  <li>My fork as a remote? Check.</li>
</ul>

<p>Great, we have everything set up right - let’s push it now! :)</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># if you are not already on the branch</span>
<span class="nv">$ </span>git checkout my-fix-local
<span class="nv">$ </span>git push</code></pre></figure>

<p>Simple!</p>

<p>For sending a pull request, you can use Github.</p>

<h3 id="updating-your-repo">Updating your repo</h3>

<p>While you were busy sorting out your import paths, someone else might have contributed some code. To update your repo, you can fetch and merge. I generally don’t like touching <code class="highlighter-rouge">rebase</code> unless necessary but you could also do a <code class="highlighter-rouge">git rebase upstream/master</code>.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git fetch upstream
<span class="nv">$ </span>git checkout master
<span class="nv">$ </span>git merge upstream/master</code></pre></figure>

<p>And…we are done! :)</p>

</article>



<section class="rss">
  <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p>
</section>

<section class="share">
  <span>Share: </span>
  
    
    
      <a href="//twitter.com/share?text=Setting+import+path+for+go+generate&url=http%3A%2F%2Flocalhost%3A4000%2Fsetting-import-path-for-go-generate&via=readfead"
        onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
        <i class="fa fa-twitter-square fa-lg"></i>
      </a>
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
      <a href="//www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fsetting-import-path-for-go-generate"
        onclick="window.open(this.href, 'linkedin-share', 'width=550,height=255');return false;">
        <i class="fa fa-linkedin-square fa-lg"></i>
      </a>
    
    
    
    
  
</section>

  <section class="post-navigation">
    <span class="prev-post">
      
        <a href="/ghc-registeration">
          <span class="fa-stack fa-lg">
            <i class="fa fa-square fa-stack-2x"></i>
            <i class="fa fa-angle-double-left fa-stack-1x fa-inverse"></i>
          </span>
          <span class="page-number">Selected for Grace Hopper Conference</span>
        </a>
      
    </span>
    <span class="next-post">
      
        <a href="/github-two-factor-authentication">
          <span class="page-number">Setting two factor authentication for Github</span>
          <span class="fa-stack fa-lg">
            <i class="fa fa-square fa-stack-2x"></i>
            <i class="fa fa-angle-double-right fa-stack-1x fa-inverse"></i>
          </span>
        </a>
      
    </span>
  </section>




<section class="disqus">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname = 'suhasramblings';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>



</div>
</div>

    </div>

    <footer class="site-footer">

  <div class="wrapper">
    <div class="site-navigation">

      <p><strong>Site Map</strong></p>
      <ul class="pages">
        
        
          <li class="nav-link"><a href="/about/">About Me</a>
        
        
        
          <li class="nav-link"><a href="/archive/">Archive</a>
        
        
        
        
        
        
        
        
        
        
        
          <li class="nav-link"><a href="/talks/">Talks</a>
        
        
        
        
        
        
        
        
        
        
      </ul>
    </div>

    <div class="site-contact">

      <p><strong>Contact</strong></p>
      <ul class="social-media-list">
        <li>
          <a href="mailto:suhaspbharadwaj@gmail.com">
            <i class="fa fa-envelope-o"></i>
            <span class="username">suhaspbharadwaj@gmail.com</span>
          </a>
        </li>

        
          
          <li>
            <a href="https://twitter.com/readfead" title="Follow me on Twitter" target="_blank">
              <i class="fa fa-twitter"></i>
              <span class="username">readfead</span>
            </a>
          </li>
          
        
          
          <li>
            <a href="https://www.quora.com/profile/Suhas-Bharadwaj" title="Follow me on Quora" target="_blank">
              <i class="fa fa-quora"></i>
              <span class="username">Suhas-Bharadwaj</span>
            </a>
          </li>
          
        
          
          <li>
            <a href="https://github.com/suhas-p-bharadwaj" title="Fork me on GitHub" target="_blank">
              <i class="fa fa-github"></i>
              <span class="username">suhas-p-bharadwaj</span>
            </a>
          </li>
          
        
          
          <li>
            <a href="https://www.linkedin.com/in/suhas-bharadwaj-ab06b638/" title="Connect with me on LinkedIn" target="_blank">
              <i class="fa fa-linkedin"></i>
              <span class="username">suhas-bharadwaj-ab06b638</span>
            </a>
          </li>
          
        

      </ul>
    </div>

    <div class="site-signature">
      <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS <i class="fa fa-rss"></i></a></strong></p>
      <p class="text">A personal website about technical things I find useful. Also, random ramblings and rants.
</p>
    </div>

  </div>

</footer>

<!-- Scripts -->
<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/js/lightbox.min.js"></script>
<script id="dsq-count-scr" src="//iammichaelhudson.disqus.com/count.js" async></script>
<script>

$(document).ready(function() {

  // Syntax highlighting
  hljs.initHighlightingOnLoad();

  // Header
  var menuToggle = $('#js-mobile-menu').unbind();
  $('#js-navigation-menu').removeClass("show");
  menuToggle.on('click', function(e) {
    e.preventDefault();
    $('#js-navigation-menu').slideToggle(function(){
      if($('#js-navigation-menu').is(':hidden')) {
        $('#js-navigation-menu').removeAttr('style');
      }
    });
  });

  //Make sure all the post's links open in a new tab
  jQuery('.post-content a, .post-excerpt a').not('.footnote, .reversefootnote').attr ('target', '_blank');

});

</script>




  </body>

</html>
